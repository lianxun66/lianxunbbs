

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>链讯-去中心化论坛</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="链讯,去中心化论坛,DAPP论坛,区块链新生态">
  <meta name="description" content="去中心化论坛,DAPP论坛,区块链新生态">
<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="stylesheet" href="/res/layui/css/layui.css">
<link rel="stylesheet" href="/res/css/global.css">
<style>
.layui-col-md8 {
    width: 100%;
}
</style><style>
		#uploadFile ~ span.layui-upload-choose{
			display: none!important;
		}
    #uploadFile{
      width: 94%;
      text-align: center;
      margin-bottom: 15px;
      margin-left:6%
    }
    .file_info{
      width: 94%;
      margin-bottom: 20px;
      margin-left:6%
    }
    .contentBox{
      width: 60%;
      margin: 20px auto 20px 40px;
    }
    .submitBtn{
      margin-top: 20px;
      margin-left: 6%;
    }
    </style>
</head>
<body>
<div class="fly-header layui-bg-black">
  <div class="layui-container">
    <a class="fly-logo" href="/index.html">
      <img src="/res/images/logo.png" alt="layui">
    </a>
    <ul class="layui-nav fly-nav layui-hide-xs">
      <li class="layui-nav-item layui-this">
        <a href="/"><i class="iconfont icon-jiaoliu"></i>交流</a>
      </li>
    </ul>
    <ul class="layui-nav fly-nav-user" id="login">
       <li class="layui-nav-item">
          <a href="/user/login.html">登入</a>
        </li>
        <li class="layui-nav-item">
          <a href="/user/reg.html">注册</a>
        </li>
 <script id="userInfo" type="text/html">
      <!-- 登入后的状态 -->
      <li class="layui-nav-item " >
        <a class="fly-nav-avatar" href="/user/set.html">
          <cite class="layui-hide-xs">{{toNickname(nickname)}}</cite>
          <img src="{{toIcon(icon,timestamp)}}">
        </a>
        <dl class="layui-nav-child layui-anim layui-anim-upbit" id="loginitem">
          <dd><a href="/user/set.html"><i class="layui-icon">&#xe620;</i>基本设置</a></dd>
			<hr style="margin: 5px 0;">
          <dd><a href="javascript:;" style="text-align: center;" onclick="exit()">退出</a></dd>
        </dl>
      </li>
</script>
    </ul>
  </div>
</div>
<div class="layui-container fly-marginTop fly-user-main">
  <ul class="layui-nav layui-nav-tree layui-inline" lay-filter="user">
    <li class="layui-nav-item layui-this">
      <a href="set.html">
        <i class="layui-icon">&#xe620;</i>
        基本设置
      </a>
    </li>
  </ul>

  <div class="site-tree-mobile layui-hide">
    <i class="layui-icon">&#xe602;</i>
  </div>
  <div class="site-mobile-shade"></div>
  
  <div class="site-tree-mobile layui-hide">
    <i class="layui-icon">&#xe602;</i>
  </div>
  <div class="site-mobile-shade"></div>
  
  
  <div class="fly-panel fly-panel-user" pad20>
    <div class="layui-tab layui-tab-brief" lay-filter="user">
      <ul class="layui-tab-title" id="LAY_mine">
        <li class="layui-this" lay-id="info">我的资料</li>
        <li lay-id="avatar">头像</li>
      </ul>
      <div class="layui-tab-content" style="padding: 20px 0;" id="edithtmlInfo">
        <div class="layui-form layui-form-pane layui-tab-item layui-show">
          <form method="post">
          <p class="file_info">
                         我的地址:  <span id="address"></span>
                        </p>
        
           <div class="layui-form-item">
              <label for="L_email" class="layui-form-label">手机</label>
              <div class="layui-input-inline">
                <input type="text" id="L_mobile" name="mobile" required lay-verify="phone" autocomplete="off" value="" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label for="L_email" class="layui-form-label">邮箱</label>
              <div class="layui-input-inline">
                <input type="text" id="L_email" name="email" required lay-verify="email" autocomplete="off" value="" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label for="L_username" class="layui-form-label">昵称</label>
              <div class="layui-input-inline">
                <input type="text" id="L_username" name="username" required lay-verify="required" autocomplete="off" value="" class="layui-input">
              </div>
              <div class="layui-inline">
                <div class="layui-input-inline">
                  <input type="radio" name="sex" value="0"  title="男">
                  <input type="radio" name="sex" value="1"  title="女">
                </div>
              </div>
            </div>
            <div class="layui-form-item">
              <label for="L_city" class="layui-form-label">城市</label>
              <div class="layui-input-inline">
                <input type="text" id="L_city" name="city" autocomplete="off" value="" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item layui-form-text">
              <label for="L_sign" class="layui-form-label">签名</label>
              <div class="layui-input-block">
                <textarea placeholder="随便写些什么刷下存在感" id="L_sign"  name="sign" value=""autocomplete="off" class="layui-textarea" style="height: 80px;"></textarea>
              </div>
            </div>
            <div class="layui-form-item">
              <button class="layui-btn" key="set-mine" lay-filter="*"id="submit" lay-submit>确认修改</button>
            </div>
          </div>
          <div class="layui-form layui-form-pane layui-tab-item">
            <div class="layui-form-item">
              <div class="avatar-add">
                <p>建议尺寸168*168，支持jpg、png、gif，最大不能超过50KB</p>
                <button type="button" class="layui-btn upload-img">
                  <i class="layui-icon">&#xe67c;</i>上传头像
                </button>
               <img id="editimguser" >
                <span class="loading"></span>
              </div>
            </div>
          </div>
          
        </div>

      </div>
    </div>
  </div>
</div>

<div class="fly-footer">
  <p><a href="javascript:;" target="_blank">链讯DAPP社区</a> 2018 &copy; <a href="javascript:;" target="_blank">链讯 出品</a></p>
</div>

<script src="/res/layui/layui.js"></script>
<script type="text/javascript" src="/dist/nebulas.js"></script>
<script type="text/javascript" src="/js/template.js"></script>
<script type="text/javascript" src="/js/jquery.min63b9.js"></script>
<script type="text/javascript" src="/js/common.js"></script>
<script>
layui.cache.page = '';
layui.cache.user = {
  username: '游客'
  ,uid: -1
  ,avatar: '../res/images/avatar/00.jpg'
  ,experience: 83
  ,sex: '男'
};
layui.config({
	  version: "3.0.0"
	  ,base: '/res/mods/'  //这里实际使用时，建议改成绝对路径
	}).extend({
	  fly: 'index'
	}).use('fly');
	var icon="";
	var nickname="";
	template.helper('toIcon', function (icon,noteId){
		  if(!icon){
			  if(noteId){
			  	icon="/res/images/avatar/"+noteId%10+".jpg";
			  }else{
				  icon="/res/images/avatar/0.jpg";
			  }
		  }
		  return icon;
	  });
	template.helper('toNickname',function (nickname){
		  if(!nickname){
			  nickname="匿名用户";
		  }
		  return nickname;
	  });
	var layuishowId;
$(function(){
	  if(localStorage.getItem("privateKey")){
		 account=new Account(localStorage.getItem("privateKey"));
		 var args=new Array();
		 args[0]=account.getAddressString();
		 readNas(PersonAddress, "get",JSON.stringify(args),function(data){
		 var result=JSON.parse(data.result);
		 if(result){
			 icon=result.icon;
			 nickname=result.nickname;
		 }
	
		 var html = template('userInfo',result); 
		 $('#login').html(html); 
		 $('#login').hover(function(){
			 $('#loginitem').addClass("layui-show");
		 },function(){
			 layuishowId= setTimeout(function(){
				 $('#loginitem').removeClass("layui-show");
			 },1000);
		 });
		 sleepUser(result);
		 $('#loginitem').hover(function(){
			 if(layuishowId){
				 clearTimeout(layuishowId);
			 }
			 $('#loginitem').addClass("layui-show");
		 },function(){
			 $('#loginitem').removeClass("layui-show");
		 });
		 });
	   }
});
function sleepUser(user){
	var edithtmlInfo=$("#edithtmlInfo");
	$("#address").text(account.getAddressString());
		if(edithtmlInfo[0]&&user){
			$("#L_mobile").val(user.mobile);
			$("#L_email").val(user.email);
			$("#L_username").val(user.nickname);
			$("#L_city").val(user.city);
			$("#L_sign").val(user.info);
		    $("input[name='sex']:eq("+user.sex+")").next().click();
		    $("#editimguser").attr("src",user.icon?user.icon:"/res/images/avatar/"+user.timestamp%10+".jpg");
		}
}
</script>
</body>
<script src="/res/mods/user.js"></script>
<script type="text/javascript">
if($('.upload-img')[0]){
    layui.use('upload', function(upload){
      var avatarAdd = $('.avatar-add');
		
      upload.render({
        elem: '.upload-img'
        ,url: '/api/upload/'
        ,size: 50
        ,before: function(){
          avatarAdd.find('.loading').show();
        }
        ,done: function(data){
        	var args=new Array();
        	args[6]=data.datas.url;
        	sendNas(PersonAddress, "edit",JSON.stringify(args),function(data){
   			 var txhash = data.txhash;
   			 layer.msg("上传成功，请等待区块确认");
   			 setTimeout(function(){
   				location.reload();
   				 },2000);
   		  });
          avatarAdd.find('.loading').hide();
        }
        ,error: function(){
          avatarAdd.find('.loading').hide();
        }
      });
    });
  }
$(function(){
	
	 $("#submit").click(function(){
		 var mobile=$("#L_mobile").val();
		 var email=$("#L_email").val();
		 var nickname=$("#L_username").val();
		 var city=$("#L_city").val();
		 var info=$("#L_sign").val();
		 var sex=$("input[name='sex']:checked").val();
			var args=new Array();
			args[0]=mobile;
			args[1]=email;
			args[2]=nickname;
			args[3]=city;
			args[4]=sex;
			args[5]=info;
		sendNas(PersonAddress, "edit",JSON.stringify(args),function(data){
			 var txhash = data.txhash;
			 layer.msg("提交成功，请等待区块确认");
			 setTimeout(function(){
				location.reload();
				 },2000);
			 
		});
	 });
});
</script>
</html>